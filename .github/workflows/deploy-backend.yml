name: Backend CI/CD

on:
  push:
    branches: [ main ]
    paths: 
      - 'back/**'
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: back/package-lock.json

      - name: Install backend dependencies
        run: |
          cd back
          npm ci

      - name: Run backend tests
        run: |
          cd back
          npm test
        continue-on-error: true

      - name: Backend validation
        run: |
          cd back
          npm run validate || echo "No validate script found"
          echo "âœ… Backend build validation complete"

  # Note: Render will automatically deploy when changes are pushed to the connected repository
  # This workflow just validates the backend code
  deploy-notification:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Backend deployment status
        run: |
          echo "ðŸš€ Backend changes pushed successfully!"
          echo "Render will automatically deploy from: https://github.com/ImmortalAl/Nexus/tree/main/back"
          echo "Monitor deployment at: https://dashboard.render.com" 