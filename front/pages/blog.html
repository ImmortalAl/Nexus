<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Share timeless reflections in an eternal sanctuary.">
    <meta name="theme-color" content="#0d0d1a">
    <title>Soul Scrolls - Immortal Nexus</title>
    <!-- Immortal-themed favicon -->
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <link rel="apple-touch-icon" href="../favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=MedievalSharp&display=swap" rel="stylesheet">
    <!-- Quill.js Rich Text Editor -->
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.2.6/purify.min.js"></script>
    <!-- Config MUST be loaded first -->
    <script src="../components/shared/config.js?v=1.4"></script>
    <script src="../js/shared/logger.js?v=1.0"></script>
    <script src="../js/shared/errorBoundary.js?v=1.0"></script>
    <!-- 1. THEME FOUNDATION (MUST BE FIRST) -->
    <link rel="stylesheet" href="../css/base-theme.css?v=1.0">
    <link rel="stylesheet" href="../css/light-theme-immortal.css?v=1.0">
    <link rel="stylesheet" href="../css/mobile-enhanced.css?v=1.0">

    <!-- EMERGENCY INLINE BLOG CARD STYLES - BYPASS ASYNC LOADING ISSUES -->
    <style>
    /* Force dark mystical card backgrounds immediately */
    .blog-post-card {
        background: linear-gradient(135deg,
            rgba(13, 13, 26, 0.98),
            rgba(26, 26, 51, 0.95),
            rgba(13, 13, 26, 0.97)
        ) !important;
        border: 2px solid rgba(255, 94, 120, 0.5) !important;
        border-radius: 20px !important;
        padding: 2rem !important;
        box-shadow:
            0 12px 40px rgba(0, 0, 0, 0.8),
            0 6px 20px rgba(255, 94, 120, 0.2),
            0 0 60px rgba(255, 94, 120, 0.15),
            inset 0 1px 0 rgba(255, 255, 255, 0.05),
            inset 0 -1px 0 rgba(255, 94, 120, 0.2) !important;
        backdrop-filter: blur(15px) !important;
        position: relative;
        margin-bottom: 2rem;
    }

    /* Card text contrast */
    .blog-post-card .post-title {
        color: #fff !important;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8) !important;
    }

    .blog-post-card .post-excerpt {
        color: rgba(255, 255, 255, 0.9) !important;
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.6) !important;
    }

    .blog-post-card .author-name {
        color: rgba(255, 255, 255, 0.95) !important;
    }

    .blog-post-card .post-date {
        color: rgba(255, 255, 255, 0.7) !important;
    }

    /* Container background */
    .scroll-archive {
        background: transparent !important;
    }

    #blogList {
        background: transparent !important;
    }

    /* Ensure page background is dark */
    body {
        background: #0d0d1a !important;
    }
    </style>

    <!-- 2. CRITICAL CSS - Above-fold essentials loaded synchronously -->
    <link rel="stylesheet" href="../css/critical.css?v=7.1">
    <link rel="stylesheet" href="../css/blog-critical.css?v=7.4">

    <!-- 3. GLOBAL STYLES - Site-wide styles loaded synchronously -->
    <link rel="stylesheet" href="../css/styles.css?v=6.1">

    <!-- 3.5. BLOG CARDS - CRITICAL for above-fold rendering (synchronous load) -->
    <link rel="stylesheet" href="../css/blog-cards.css?v=5.2">

    <!-- 4. PROGRESSIVE LOADING - Non-critical CSS loaded asynchronously -->
    <link rel="preload" href="../css/layout.css?v=8.2" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/layout.css?v=8.2"></noscript>
    
    <link rel="preload" href="../css/components.css?v=7.2" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/components.css?v=7.2"></noscript>
    
    <!-- Features CSS - loaded synchronously for critical voting UI -->
    <link rel="stylesheet" href="../css/features.css?v=8.5">

    <!-- Immortal Enhancements -->
    <link rel="preload" href="../css/z-index-system.css?v=1.2" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/z-index-system.css?v=1.2"></noscript>

    <link rel="preload" href="../css/micro-interactions.css?v=1.0" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/micro-interactions.css?v=1.0"></noscript>

    <!-- 4.5. COMPONENT STYLES -->
    <link rel="preload" href="../css/components/buttons.css?v=1.1" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/components/buttons.css?v=1.1"></noscript>

    <link rel="preload" href="../css/components/spinners.css?v=1.0" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/components/spinners.css?v=1.0"></noscript>

    <!-- 4.6. UNIFIED MODAL SYSTEM -->
    <link rel="preload" href="../css/unified-modals.css?v=2.0" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/unified-modals.css?v=2.0"></noscript>

    <!-- 4.7. VIEWPORT OPTIMIZATIONS (critical for responsive design) -->
    <link rel="stylesheet" href="../css/viewport-optimizations.css?v=1.2">

    <!-- 5. SHARED COMPONENTS (lazy loaded) -->
    <link rel="preload" href="../components/shared/styles.css?v=6.1" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../components/shared/styles.css?v=6.1"></noscript>
    
    <link rel="preload" href="../components/shared/rich-text-editor.css?v=2.0" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../components/shared/rich-text-editor.css?v=2.0"></noscript>
    
    <!-- 6. PAGE-SPECIFIC (lazy loaded) -->
    <link rel="preload" href="../components/shared/active-users.css?v=2.1" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../components/shared/active-users.css?v=2.1"></noscript>
    
    <!-- Blog-specific modules (lazy loaded) -->
    <!-- blog-cards.css now loaded synchronously above -->

    <link rel="preload" href="../css/blog-modal.css?v=3.9" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/blog-modal.css?v=3.9"></noscript>
    
    <link rel="preload" href="../css/blog-forms.css?v=2.3" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/blog-forms.css?v=2.3"></noscript>
    
    <link rel="preload" href="../css/blog-comments.css?v=2.4" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/blog-comments.css?v=2.4"></noscript>
    
    <link rel="preload" href="../css/blog-responsive.css?v=2.4" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/blog-responsive.css?v=2.4"></noscript>
    
    <!-- 7. EXTERNAL RESOURCES (lazy loaded) -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer"></noscript>
</head>
<body>
    <header>
        <!-- SHARED_HEADER -->
    </header>

    <!-- Active Users Sidebar, Floating Buttons, and Message Modal will be dynamically injected by shared components -->

    <main>
        <div class="scroll-archive">
            <div class="soul-scrolls-header">
                <div class="header-ornament header-ornament-left">
                    <div class="infinity-symbol">∞</div>
                    <div class="mystic-runes">⟡ ⟐ ⟡</div>
                </div>
                
                <div class="main-title-container">
                    <div class="title-backdrop"></div>
                    <h1 class="soul-scrolls-title">
                        <span class="title-word soul">Soul</span>
                        <span class="title-word scrolls">Scrolls</span>
                    </h1>
                    <div class="subtitle">Ancient Wisdom • Digital Eternity</div>
                </div>
                
                <div class="header-ornament header-ornament-right">
                    <div class="mystic-runes">⟡ ⟐ ⟡</div>
                    <div class="infinity-symbol">∞</div>
                </div>
            </div>
            
            <!-- Inscribe a Scroll button and Archive link -->
            <div class="inscribe-scroll-container">
                <button class="inscribe-scroll-btn" onclick="window.location.href='/lander.html?expand=editor'" title="Scrolls are crafted in the Eternal Hearth">
                    <i class="fas fa-feather-alt"></i>
                    <span>Inscribe a Scroll</span>
                    <small>✨ Crafted in the Eternal Hearth</small>
                </button>
                <a href="scrolls-archive.html" class="btn btn-outline archive-link-btn">
                    <i class="fas fa-archive"></i>
                    <span>Browse Archive</span>
                    <small>View all scrolls</small>
                </a>
            </div>

            <!-- Search Bar -->
            <div class="blog-search-section">
                <div class="blog-search-box">
                    <i class="fas fa-search"></i>
                    <input type="text"
                           id="blogSearchInput"
                           placeholder="Search scrolls by title, author, or content..."
                           class="blog-search-input"
                           oninput="window.BlogUI.handleSearch(this.value)">
                </div>
                <div class="search-results-info" style="display: none;"></div>
            </div>

            <div id="blogList" class="scroll-grid"></div>
            
            <div id="scroll-observer" class="ancient-loader" style="display:none;">
                <div class="relic-spinner"></div>
                <div class="loading-text">Unearthing more scrolls...</div>
            </div>
        </div>
    </main>

    <!-- Legacy sharing modal - hidden but kept for compatibility -->
    <div id="sharing-modal" class="parchment-scroll" style="display: none !important;" onclick="if(event.target === this) closeOwlModal()">
        <div class="incantation-box">
            <h3>🔗 Share this Scroll</h3>
            <div class="owl-messenger">
                <p style="text-align: center; color: var(--ink); margin-bottom: 1rem;">This sharing method has been updated to a more modern approach.</p>
                <input type="hidden" id="share-url">
            </div>
            <button onclick="closeOwlModal()" class="owl-button">Close</button>
        </div>
    </div>

    <!-- Full Blog Post Modal -->
    <div id="blogModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="modal-title" aria-describedby="modal-content" style="display:none;">
        <div class="blog-modal-content" role="document">
            <!-- Loading State -->
            <div class="modal-loading" id="modalLoading" style="display:none;">
                <div class="modal-spinner">
                    <div class="relic-spinner"></div>
                </div>
                <p>Unfurling ancient scroll...</p>
            </div>

            <!-- Modal Content (scrollable area) -->
            <div class="modal-body" id="modalBody">
                <!-- Unified Modal Header Bar (now INSIDE scrollable area so avatar scrolls away) -->
                <div class="modal-header-bar" id="blogModalHeader">
                    <!-- AuthorIdentityCard will populate this dynamically -->
                    <!-- Close Button will be added separately -->
                    <div class="modal-header-controls">
                        <button class="close-modal" onclick="closeBlogModal()" aria-label="Close modal">×</button>
                    </div>
                </div>
                
                <!-- Title Section -->
                <h2 id="modal-title" class="scroll-title"></h2>

                <!-- Content -->
                <article id="modal-content" class="scroll-content" role="main"></article>
                
                <!-- Action Buttons -->
                <div class="modal-actions">
                    <button id="editPostBtn" class="edit-post-btn" onclick="editCurrentPost()" style="display: none;">
                        <i class="fas fa-edit"></i> Edit this scroll
                    </button>
                    <button id="deletePostBtn" class="delete-post-btn" onclick="confirmDeleteCurrentPost()" style="display: none;">
                        <i class="fas fa-trash"></i> Delete this scroll
                    </button>
                    <button class="copy-link-btn" onclick="copyPostLink()">
                        <i class="fas fa-link"></i> Copy link
                    </button>
                </div>
                
                <!-- Comments Section -->
                <div class="blog-comments">
                    <div id="blogComments"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Counterpoint Modal -->
    <div id="counterpointModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="counterpoint-title" style="display:none;">
        <div class="modal-content parchment-modal">
            <div class="modal-header">
                <h3 id="counterpoint-title">
                    <i class="fas fa-scale-balanced"></i> Write Counterpoint
                </h3>
                <button class="close-modal" onclick="closeCounterpointModal()" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-instruction">
                    <i class="fas fa-info-circle"></i>
                    Provide a well-reasoned counterargument with supporting sources
                </p>

                <form id="counterpointForm" class="chronicle-form">
                    <input type="hidden" id="counterpointPostId" value="">

                    <div class="form-group">
                        <label for="counterpointText">Your Counterpoint</label>
                        <textarea id="counterpointText" name="counterpoint" rows="6"
                                  placeholder="State your disagreement clearly and respectfully..."
                                  required></textarea>
                        <small>Challenge with reason, not rhetoric</small>
                    </div>

                    <div class="form-group">
                        <label for="counterpointSources">
                            <i class="fas fa-link"></i> Sources & Citations
                        </label>
                        <textarea id="counterpointSources" name="sources" rows="4"
                                  placeholder="List your sources (one per line):&#10;https://example.com/source1&#10;https://example.com/source2"></textarea>
                        <small>Build credibility with verified sources</small>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-outline" onclick="closeCounterpointModal()">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Submit Counterpoint
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer>
        <p>Eternal Year 1 - Immortal Nexus. Eternity is ours.</p>
    </footer>

    <!-- Rich Text Editor Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
    <script src="../components/shared/rich-text-editor.js?v=1.0"></script>
    
    <!-- Core Immortal Nexus Components -->
    <script src="../components/shared/nexus-core.js?v=1.5"></script>
    <script src="../components/shared/themeManager.js?v=2.2"></script>
    <script src="../js/nexus-avatar-system.js?v=3.2"></script>
    <script src="../components/shared/navigation.js?v=2.1"></script>
    <script src="../components/shared/userMenu.js?v=7.2"></script>
    <script src="../components/shared/activeUsers.js?v=2.3"></script>
    <script src="../components/shared/messageModal.js?v=6.9"></script>

    <!-- Unified Voting System - IMMORTAL! -->
    <script src="../js/shared/unifiedVoting.js?v=1.6"></script>
    <script src="../components/shared/authorIdentityCard.js?v=2.3"></script>

    <script src="../components/shared/comments.js?v=1.6"></script>

    <!-- Blog System Modules (Load in dependency order) -->
    <script src="../js/blog/blog-api.js?v=1.0"></script>
    <script src="../js/blog/blog-voting.js?v=1.4"></script>
    <script src="../js/blog/blog-comments.js?v=1.6"></script>
    <script src="../js/blog/blog-editor.js?v=1.1"></script>
    <script src="../js/blog/blog-modal.js?v=1.7"></script>
    <script src="../js/blog/blog-ui.js?v=3.0"></script>

    <!-- Blog Main Module (Load last - orchestrator) -->
    <script src="../js/blog.js?v=6.0"></script>

    <!-- <script src="../js/scripts.js?v=1.2"></script> --> <!-- Legacy script - functionality moved to components -->
    
    <!-- Analytics Tracking System -->
    <script src="../js/analytics-tracker.js?v=2.1" async></script>
</body>
</html>