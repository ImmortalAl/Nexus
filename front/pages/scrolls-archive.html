<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Soul Scrolls Archive - Browse all eternal wisdom from the Immortal Nexus">
    <meta name="theme-color" content="#0d0d1a">
    <title>Soul Scrolls Archive - Immortal Nexus</title>
    <!-- Immortal-themed favicon -->
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <link rel="apple-touch-icon" href="../favicon.svg">

    <!-- Config MUST be loaded first -->
    <script src="../components/shared/config.js?v=2.0"></script>
    <script src="../js/shared/logger.js?v=1.0"></script>
    <script src="../js/shared/errorBoundary.js?v=1.0"></script>

    <!-- 1. THEME FOUNDATION (MUST BE FIRST) -->
    <link rel="stylesheet" href="../css/base-theme.css?v=1.0">
    <link rel="stylesheet" href="../css/light-theme-immortal.css?v=1.0">
    <link rel="stylesheet" href="../css/mobile-enhanced.css?v=1.0">

    <!-- 2. CRITICAL CSS -->
    <link rel="stylesheet" href="../css/critical.css?v=7.9">
    <link rel="stylesheet" href="../css/styles.css?v=6.1">

    <!-- 3. LAYOUT AND COMPONENTS -->
    <link rel="stylesheet" href="../css/layout.css?v=8.5">
    <link rel="stylesheet" href="../css/components.css?v=7.2">
    <link rel="stylesheet" href="../css/features.css?v=8.5">

    <!-- 4. Z-INDEX SYSTEM -->
    <link rel="stylesheet" href="../css/z-index-system.css?v=1.2">

    <!-- 5. UNIFIED MODAL SYSTEM -->
    <link rel="stylesheet" href="../css/unified-modals.css?v=2.0">

    <!-- 6. SHARED COMPONENTS -->
    <link rel="stylesheet" href="../components/shared/styles.css?v=6.1">
    <link rel="stylesheet" href="../components/shared/active-users.css?v=2.1">

    <!-- 7. ARCHIVE-SPECIFIC STYLES -->
    <link rel="stylesheet" href="../css/scrolls-archive.css?v=1.0">

    <!-- 8. BLOG MODAL STYLES (needed for viewing scrolls) -->
    <link rel="preload" href="../css/blog-modal.css?v=3.9" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/blog-modal.css?v=3.9"></noscript>

    <link rel="preload" href="../css/blog-comments.css?v=2.4" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/blog-comments.css?v=2.4"></noscript>

    <!-- 9. EXTERNAL RESOURCES -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
          integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
          crossorigin="anonymous">

    <!-- 9. FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=MedievalSharp&family=Montserrat:wght@300;400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <!-- SHARED_HEADER -->
    </header>

    <!-- Active Users Sidebar, Floating Buttons, and Message Modal will be dynamically injected -->

    <main>
        <div class="archive-container">
            <!-- Archive Header -->
            <div class="archive-header">
                <div class="archive-title-section">
                    <h1 class="archive-title">
                        <i class="fas fa-archive"></i>
                        Soul Scrolls Archive
                    </h1>
                    <p class="archive-subtitle">Eternal repository of all sacred writings</p>
                </div>

                <!-- Navigation Actions -->
                <div class="archive-nav">
                    <a href="blog.html" class="btn btn-outline">
                        <i class="fas fa-scroll"></i> View Latest Scrolls
                    </a>
                    <a href="/lander.html?expand=editor" class="btn btn-primary">
                        <i class="fas fa-feather-alt"></i> Inscribe New Scroll
                    </a>
                </div>
            </div>

            <!-- Search and Filter Bar -->
            <div class="archive-controls">
                <div class="search-section">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text"
                               id="archiveSearch"
                               placeholder="Search by title, author, or content..."
                               class="archive-search-input">
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-group">
                        <label for="sortBy">Sort by:</label>
                        <select id="sortBy" class="archive-select">
                            <option value="createdAt:desc">Newest First</option>
                            <option value="createdAt:asc">Oldest First</option>
                            <option value="likes:desc">Most Upvoted</option>
                            <option value="commentsCount:desc">Most Discussed</option>
                            <option value="author.username:asc">Author Name</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="dateRange">Time:</label>
                        <select id="dateRange" class="archive-select">
                            <option value="all">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="year">This Year</option>
                        </select>
                    </div>

                    <button id="applyFilters" class="btn btn-sm btn-outline">
                        <i class="fas fa-filter"></i> Apply
                    </button>
                </div>
            </div>

            <!-- Stats Bar -->
            <div class="archive-stats" id="archiveStats">
                <span class="stat-item">
                    <i class="fas fa-scroll"></i>
                    <span id="totalScrolls">0</span> Total Scrolls
                </span>
                <span class="stat-item">
                    <i class="fas fa-users"></i>
                    <span id="totalAuthors">0</span> Authors
                </span>
                <span class="stat-item">
                    <i class="fas fa-eye"></i>
                    Showing <span id="showingCount">0</span> of <span id="totalCount">0</span>
                </span>
            </div>

            <!-- Archive Table (Desktop) / Cards (Mobile) -->
            <div class="archive-content" id="archiveContent">
                <!-- Desktop Table View -->
                <table class="archive-table" id="archiveTable">
                    <thead>
                        <tr>
                            <th class="col-title sortable" data-sort="title">
                                Title <i class="fas fa-sort"></i>
                            </th>
                            <th class="col-author sortable" data-sort="author.username">
                                Author <i class="fas fa-sort"></i>
                            </th>
                            <th class="col-date sortable" data-sort="createdAt">
                                Date <i class="fas fa-sort"></i>
                            </th>
                            <th class="col-stats sortable" data-sort="likes">
                                <i class="fas fa-thumbs-up" title="Upvotes"></i>
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="col-stats sortable" data-sort="commentsCount">
                                <i class="fas fa-comment" title="Comments"></i>
                                <i class="fas fa-sort"></i>
                            </th>
                            <th class="col-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="archiveTableBody">
                        <!-- Loading state -->
                        <tr class="loading-row">
                            <td colspan="6">
                                <div class="loading-spinner">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span>Loading archive...</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- Mobile Cards View (hidden by default, shown via CSS on mobile) -->
                <div class="archive-mobile-cards" id="archiveMobileCards">
                    <!-- Cards will be inserted here by JavaScript -->
                </div>
            </div>

            <!-- Pagination -->
            <div class="archive-pagination" id="archivePagination">
                <!-- Pagination controls will be inserted here -->
            </div>
        </div>
    </main>

    <!-- Blog Post Modal (for viewing full scrolls) -->
    <div id="blogModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="modal-title" aria-describedby="modal-content" style="display:none;">
        <div class="blog-modal-content" role="document">
            <!-- Loading State -->
            <div class="modal-loading" id="modalLoading" style="display:none;">
                <div class="modal-spinner">
                    <div class="relic-spinner"></div>
                </div>
                <p>Unfurling ancient scroll...</p>
            </div>

            <!-- Modal Content (scrollable area) -->
            <div class="modal-body" id="modalBody">
                <!-- Unified Modal Header Bar (now INSIDE scrollable area so avatar scrolls away) -->
                <div class="modal-header-bar" id="blogModalHeader">
                    <!-- AuthorIdentityCard will populate this dynamically -->
                    <!-- Close Button will be added separately -->
                    <div class="modal-header-controls">
                        <button class="close-modal" onclick="closeBlogModal()" aria-label="Close modal">×</button>
                    </div>
                </div>

                <!-- Title Section -->
                <h2 id="modal-title" class="scroll-title"></h2>

                <!-- Content -->
                <article id="modal-content" class="scroll-content" role="main"></article>

                <!-- Action Buttons -->
                <div class="modal-actions">
                    <button id="editPostBtn" class="edit-post-btn" onclick="editCurrentPost()" style="display: none;">
                        <i class="fas fa-edit"></i> Edit this scroll
                    </button>
                    <button id="deletePostBtn" class="delete-post-btn" onclick="confirmDeleteCurrentPost()" style="display: none;">
                        <i class="fas fa-trash"></i> Delete this scroll
                    </button>
                    <button class="copy-link-btn" onclick="copyPostLink()">
                        <i class="fas fa-link"></i> Copy link
                    </button>
                </div>

                <!-- Comments Section -->
                <div class="blog-comments">
                    <div id="blogComments"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Counterpoint Modal (for challenges) -->
    <div id="counterpointModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="counterpoint-title" style="display:none;">
        <div class="modal-content parchment-modal">
            <div class="modal-header">
                <h3 id="counterpoint-title">
                    <i class="fas fa-scale-balanced"></i> Write Counterpoint
                </h3>
                <button class="close-modal" onclick="closeCounterpointModal()" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-instruction">
                    <i class="fas fa-info-circle"></i>
                    Provide a well-reasoned counterargument with supporting sources
                </p>

                <form id="counterpointForm" class="chronicle-form">
                    <input type="hidden" id="counterpointPostId" value="">

                    <div class="form-group">
                        <label for="counterpointText">Your Counterpoint</label>
                        <textarea id="counterpointText" name="counterpoint" rows="6"
                                  placeholder="State your disagreement clearly and respectfully..."
                                  required></textarea>
                        <small>Challenge with reason, not rhetoric</small>
                    </div>

                    <div class="form-group">
                        <label for="counterpointSources">
                            <i class="fas fa-link"></i> Sources & Citations
                        </label>
                        <textarea id="counterpointSources" name="sources" rows="4"
                                  placeholder="List your sources (one per line):&#10;https://example.com/source1&#10;https://example.com/source2"></textarea>
                        <small>Build credibility with verified sources</small>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-outline" onclick="closeCounterpointModal()">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Submit Counterpoint
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer>
        <p>Eternal Year 1 - Immortal Nexus. Eternity is ours.</p>
    </footer>

    <!-- Core Immortal Nexus Components -->
    <script src="../components/shared/themeManager.js?v=2.2"></script>
    <script src="../components/shared/nexus-core.js?v=1.5"></script>
    <script src="../components/shared/authManager.js?v=1.4"></script>
    <script src="../components/shared/authModal.js?v=4.2"></script>
    <script src="../components/shared/apiClient.js?v=1.5"></script>
    <script src="../components/shared/navigation.js?v=2.1"></script>
    <script src="../components/shared/userMenu.js?v=7.2"></script>

    <!-- Avatar System -->
    <script src="../js/nexus-avatar-system.js?v=3.2"></script>

    <!-- Unified Voting System -->
    <script src="../js/shared/unifiedVoting.js?v=1.6"></script>

    <!-- Author Identity and Comments (needed for modal) -->
    <script src="../components/shared/authorIdentityCard.js?v=2.3"></script>
    <script src="../components/shared/comments.js?v=1.6"></script>

    <!-- Blog Modules (needed for modal functionality) -->
    <script src="../js/blog/blog-api.js?v=1.0"></script>
    <script src="../js/blog/blog-modal.js?v=1.7"></script>
    <script src="../js/blog/blog-voting.js?v=1.4"></script>
    <script src="../js/blog/blog-comments.js?v=1.6"></script>

    <!-- Active Users -->
    <script src="../components/shared/activeUsers.js?v=2.3"></script>
    <script src="../components/shared/messageModal.js?v=6.9"></script>

    <!-- Archive-specific JavaScript -->
    <script src="../js/scrolls-archive.js?v=1.1"></script>

    <!-- Analytics Tracking System -->
    <script src="../js/analytics-tracker.js?v=2.1" async></script>
</body>
</html>